# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

tasks:
  init:
    desc: Initialize Brewfile
    cmds:
      - ln -sf $(pwd)/Brewfile ~/Brewfile
  list:
    cmds:
      - brew list -1 --cask --full-name
      - brew list --installed-on-request --full-name
  diff:
    cmds:
      - diff -u --color ./Brewfile ~/Brewfile
    ignore_error: true
    silent: true

  bundle:
    desc: Generate Brewfile
    vars:
      FORMULAE:
        sh: brew list --installed-on-request --full-name
      CASKS:
        sh: brew list --cask --full-name
    cmds:
      - rm -f ~/Brewfile
      - touch ~/Brewfile
      - for: { var: FORMULAE }
        cmd: echo 'brew "{{.ITEM}}"' >> ~/Brewfile
      - echo '' >> ~/Brewfile
      - for: { var: CASKS }
        cmd: echo 'cask "{{.ITEM}}"' >> ~/Brewfile
      - task: diff
    silent: true

  apply:
    desc: Apply Local Brewfile to Remote
    cmds:
      - cp ~/Brewfile ./Brewfile
      # git commit , push
    silent: true

  reset:
    deps:
      - diff
    desc: Reset Local Brewfile to Remote Condition
    prompt: Are you sure you want to reset the Brewfile?
    cmds:
      - cp ./Brewfile ~/Brewfile
      - brew bundle cleanup --force
    silent: true
    preconditions:
      - sh: "! diff ./Brewfile ~/Brewfile"
